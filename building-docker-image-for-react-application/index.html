<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Building docker image for a REACT App</title><meta name="description" content="React,docker, docker image, react docker, react kubernetes, react aks"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://alokdhari.com/building-docker-image-for-react-application/"><link rel="alternate" type="application/atom+xml" href="https://alokdhari.com/feed.xml"><link rel="alternate" type="application/json" href="https://alokdhari.com/feed.json"><meta property="og:title" content="Building docker image for a REACT App"><meta property="og:image" content="https://alokdhari.com/media/posts/10/florian-olivo-4hbJ-eymZ1o-unsplash.jpg"><meta property="og:site_name" content="alokdhari.com"><meta property="og:description" content="React,docker, docker image, react docker, react kubernetes, react aks"><meta property="og:url" content="https://alokdhari.com/building-docker-image-for-react-application/"><meta property="og:type" content="article"><link rel="shortcut icon" href="https://alokdhari.com/media/website/logo.png" type="image/png"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link href="https://fonts.googleapis.com/css?family=Noto+Serif:400,700&amp;subset=latin-ext&amp;display=swap" rel="stylesheet"><style>:root{--body-font:'Noto Serif',serif;--heading-font:var(--body-font);--logo-font:var(--body-font);--menu-font:var(--body-font)}</style><link rel="stylesheet" href="https://alokdhari.com/assets/css/style.css?v=63203dd1fdeec5683de89bf78f90a3af"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://alokdhari.com/building-docker-image-for-react-application/"},"headline":"Building docker image for a REACT App","datePublished":"2021-03-18T02:24","dateModified":"2021-03-21T20:30","image":{"@type":"ImageObject","url":"https://alokdhari.com/media/posts/10/florian-olivo-4hbJ-eymZ1o-unsplash.jpg","height":4000,"width":6000},"description":"Let me start by sharing my final docker file. The docker file builds a react project and serves it using nginx. It itself is pretty&hellip;","author":{"@type":"Person","name":"Alok Singh"},"publisher":{"@type":"Organization","name":"Alok Singh","logo":{"@type":"ImageObject","url":"https://alokdhari.com/media/website/logo-2-Alok-Blog.png","height":100,"width":200}}}</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-Q8ZKEPSG49"></script><script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Q8ZKEPSG49');</script></head><body><div class="container js-container"><nav class="menu"><ul class="navbar__menu"><li><a href="https://alokdhari.com/about-me/" target="_self">About me</a></li><li><a href="https://alokdhari.com/tags/startup-lessons/" target="_self">Startup Lessons</a></li><li><a href="https://alokdhari.com/tags/talking-about-life/" target="_self">Life</a></li><li><a href="https://alokdhari.com/tags/technology/">Tech stuff</a></li></ul></nav><div class="content"><header class="top"><div class="top__item"><a class="logo" href="https://alokdhari.com/"><img src="https://alokdhari.com/media/website/logo-2-Alok-Blog.png" alt="alokdhari.com"></a></div><div class="top__item top__item--right"><button class="menu-toggle js-menu-toggle" aria-label="Menu" aria-expanded="false"><span class="menu-toggle-box"><span class="menu-toggle-inner">Menu</span></span></button></div></header><main class="main"><article class="post"><div class="main__left"><figure class="hero"><img src="https://alokdhari.com/media/posts/10/florian-olivo-4hbJ-eymZ1o-unsplash.jpg" srcset="https://alokdhari.com/media/posts/10/responsive/florian-olivo-4hbJ-eymZ1o-unsplash-xs.jpg 300w, https://alokdhari.com/media/posts/10/responsive/florian-olivo-4hbJ-eymZ1o-unsplash-sm.jpg 480w, https://alokdhari.com/media/posts/10/responsive/florian-olivo-4hbJ-eymZ1o-unsplash-md.jpg 768w, https://alokdhari.com/media/posts/10/responsive/florian-olivo-4hbJ-eymZ1o-unsplash-lg.jpg 1024w, https://alokdhari.com/media/posts/10/responsive/florian-olivo-4hbJ-eymZ1o-unsplash-xl.jpg 1280w, https://alokdhari.com/media/posts/10/responsive/florian-olivo-4hbJ-eymZ1o-unsplash-2xl.jpg 1600w" sizes="(min-width: 61.3125em) 50vw, 100vw" loading="eager" height="4000" width="6000" alt=""></figure><header><h1>Building docker image for a REACT App</h1></header></div><div class="main__right"><div class="post__entry"><p>Let me start by sharing my final docker file. The docker file builds a react project and serves it using nginx.</p><p>It itself is pretty descriptive, but if there is anything you don't understand then ping me.</p><div><pre>#First we build the app.<br><br>FROM node:alpine3.10 as build<br><br>WORKDIR /app<br><br>RUN echo "Starting stage 1 Build"<br><br>#We pass arguments to run our build<br>ARG yourregistrytoken<br>ARG someapiurl<br>ARG cdnurl<br>ARG buildNumber<br><br>ENV NODE_ENV=production<br><br>COPY .dockernpmrc ./.npmrc<br><br>COPY ["package.json", "package-lock.json*", "./"]<br><br>RUN npm set progress=false &amp;&amp; \<br>    npm config set depth 0 &amp;&amp; \<br>    npm install --only=production    <br><br>RUN rm -f .npmrc<br><br>COPY . ./<br><br>RUN rm -f .env<br>RUN rm -f .env.local<br>RUN rm -rf build<br><br># I have a custom docker env file that I copy and replace values in.<br>COPY .dockerenv ./.env<br><br># This code below replaces the values from the argument.<br>RUN sed -i "s/#someapiurl#/${someapiurl}/g" ./.env<br>RUN sed -i "s/#cdnurl#/${cdnurl}/g" ./.env<br>RUN sed -i "s/#buildNumber#/${buildNumber}/g" ./package.json<br>RUN cat ./.env<br><br># Just to check what is going on with the files.<br>RUN ls -al<br><br># Let's run the NPM build<br>RUN npm run build<br><br># #Stage two - Take the Build folder and serve :)<br><br>FROM nginx:alpine<br>RUN rm /etc/nginx/conf.d/default.conf<br>COPY --from=build /app/build /usr/share/nginx/html<br>COPY ./nginx.conf /etc/nginx/conf.d<br><br>ENTRYPOINT ["nginx", "-g", "daemon off;"]<br><br><br><br><br></pre><hr><p>There are 2 files that are very important for the execution to work. The ".dockerenv" which looks like this</p><pre>REACT_APP_Dashboard_Api_URL=https://#someapiurl#/api<br>REACT_APP_imagecdn=https://#cdnurl#<br>SKIP_PREFLIGHT_CHECK=true<br>Version=#version#</pre><p>I replace all these values using <strong>sed</strong>. These values are then embedded into the built application which is where I spent an awful lot of time. On K8S, injecting values using config-maps  just does not work for react applications. Using this way also means we can inject values at build time and can easily integrate for CI/CD. </p><p>This results in a super tiny docker image of about 40 Mb and runs smoothly in K8S. The load time is zero for the image is compiled and the entry point is with nginx. Honestly, it took me a while to get to this and I really hope I save someone some time. :) </p></div><footer><div class="post__tag-share"><ul class="post__tag"><li><a href="https://alokdhari.com/tags/technology/">Technology</a></li></ul><div class="post__share"><a href="http://www.linkedin.com/shareArticle?url=https%3A%2F%2Falokdhari.com%2Fbuilding-docker-image-for-react-application%2F&amp;title=Building%20docker%20image%20for%20a%20REACT%20App" class="js-share linkedin" aria-label="[MISSING TRANSLATION] Share with LinkedIn" rel="nofollow noopener noreferrer"><svg class="icon"><use xlink:href="https://alokdhari.com/assets/svg/svg-map.svg#linkedin"/></svg></a></div></div></footer></div></div></article><div class="main__right"><div class="comments"><h3>Comments</h3><div id="disqus_thread"></div><script>var disqus_config = function () {
                             this.page.url = 'https://alokdhari.com/building-docker-image-for-react-application/';
                     		this.page.identifier = '10';
                         };
                     
                         var disqus_loaded = false;
                     
                         function publiiLoadDisqus() {
                             if(disqus_loaded) {
                                 return false;
                             }
                     
                             var top = document.getElementById('disqus_thread').offsetTop;
                     
                             if (!disqus_loaded && (window.scrollY || window.pageYOffset) + window.innerHeight > top) {
                                 disqus_loaded = true;
                     
                                 (function () {
                                     var d = document, s = d.createElement('script');
                                     s.src = 'https://alokdhari-com.disqus.com/embed.js';
                                     s.setAttribute('data-timestamp', +new Date());
                                     (d.head || d.body).appendChild(s);
                                 })();
                             }
                         }
                     
                         publiiLoadDisqus();
                     
                         window.onscroll = function() {
                             publiiLoadDisqus();
                         };</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></div></div></main><footer class="footer"><div class="footer__social"><a href="https://www.linkedin.com/in/alokdharisingh/" class="linkedin" aria-label="LinkedIn"><svg class="icon"><use xlink:href="https://alokdhari.com/assets/svg/svg-map.svg#linkedin"/></svg></a></div><div class="footer__copyright">Powered by <a href="https://getpublii.com" target="_blank" rel="nofollow noopener">Publii</a>, <a href="https://pages.github.com/">Github Pages</a> and gorgeous images from <a href="https://unsplash.com">Unsplash</a></div></footer></div></div><script defer="defer" src="https://alokdhari.com/assets/js/scripts.min.js?v=babd20e2a0a25821e63a0529c9feaae0"></script><script>var images = document.querySelectorAll('img[loading]');
   
           for (var i = 0; i < images.length; i++) {
               if (images[i].complete) {
                   images[i].classList.add('is-loaded');
               } else {
                   images[i].addEventListener('load', function () {
                       this.classList.add('is-loaded');
                   }, false);
               }
           }</script></body></html>