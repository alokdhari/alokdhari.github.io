<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>React App Build on Docker for Kubernetes - alokdhari.com</title><meta name="description" content="React APP in docker"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://alokdhari.com/react-app-build-on-docket-in-kubernetes/"><link rel="alternate" type="application/atom+xml" href="https://alokdhari.com/feed.xml"><link rel="alternate" type="application/json" href="https://alokdhari.com/feed.json"><meta property="og:title" content="React App Build on Docker for Kubernetes"><meta property="og:image" content="https://alokdhari.com/media/website/logo-2-Alok-Blog.png"><meta property="og:site_name" content="alokdhari.com"><meta property="og:description" content="React APP in docker"><meta property="og:url" content="https://alokdhari.com/react-app-build-on-docket-in-kubernetes/"><meta property="og:type" content="article"><link rel="shortcut icon" href="https://alokdhari.com/media/website/logo.png" type="image/png"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link href="https://fonts.googleapis.com/css?family=Noto+Serif:400,700&amp;subset=latin-ext&amp;display=swap" rel="stylesheet"><style>:root{--body-font:'Noto Serif',serif;--heading-font:var(--body-font);--logo-font:var(--body-font);--menu-font:var(--body-font)}</style><link rel="stylesheet" href="https://alokdhari.com/assets/css/style.css?v=48c69721e11957a773f5b7be5d9d9c27"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://alokdhari.com/react-app-build-on-docket-in-kubernetes/index.html"},"headline":"React App Build on Docker for Kubernetes","datePublished":"2021-03-18T02:24","dateModified":"2021-03-18T02:24","image":{"@type":"ImageObject","url":"https://alokdhari.com/media/website/logo-2-Alok-Blog.png","height":100,"width":200},"description":"Let me start by sharing my final docker file. The docker file builds a react project and serves it using nginx. It itself is pretty&hellip;","author":{"@type":"Person","name":"Alok Singh"},"publisher":{"@type":"Organization","name":"Alok Singh","logo":{"@type":"ImageObject","url":"https://alokdhari.com/media/website/logo-2-Alok-Blog.png","height":100,"width":200}}}</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-110166922-1"></script><script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-110166922-1');</script></head><body><div class="container js-container"><nav class="menu"><ul class="navbar__menu"><li><a href="https://alokdhari.com/about-me/index.html" target="_self">About me</a></li><li><a href="https://alokdhari.com/tags/talking-about-life/index.html" target="_self">Life</a></li><li><a href="https://alokdhari.com/tags/technology/index.html">Tech stuff</a></li></ul></nav><div class="content"><header class="top"><div class="top__item"><a class="logo" href="https://alokdhari.com/index.html"><img src="https://alokdhari.com/media/website/logo-2-Alok-Blog.png" alt="alokdhari.com"></a></div><div class="top__item top__item--right"><button class="menu-toggle js-menu-toggle" aria-label="Menu" aria-expanded="false"><span class="menu-toggle-box"><span class="menu-toggle-inner">Menu</span></span></button></div></header><main class="main"><article class="post"><div class="main__left"><figure class="hero"><img src="https://alokdhari.com/media/website/sarah-dorweiler-x2Tmfd1-SgA-unsplash.jpg" srcset="https://alokdhari.com/media/website/responsive/sarah-dorweiler-x2Tmfd1-SgA-unsplash-xs.jpg 300w, https://alokdhari.com/media/website/responsive/sarah-dorweiler-x2Tmfd1-SgA-unsplash-sm.jpg 480w, https://alokdhari.com/media/website/responsive/sarah-dorweiler-x2Tmfd1-SgA-unsplash-md.jpg 768w, https://alokdhari.com/media/website/responsive/sarah-dorweiler-x2Tmfd1-SgA-unsplash-lg.jpg 1024w, https://alokdhari.com/media/website/responsive/sarah-dorweiler-x2Tmfd1-SgA-unsplash-xl.jpg 1280w, https://alokdhari.com/media/website/responsive/sarah-dorweiler-x2Tmfd1-SgA-unsplash-2xl.jpg 1600w" sizes="(min-width: 61.3125em) 50vw, 100vw" loading="eager" width="1129" height="1272" alt=""></figure><header><h1>React App Build on Docker for Kubernetes</h1><p><time datetime="2021-03-18T02:24">Thursday, March 18, 2021 </time>by <a href="https://alokdhari.com/authors/alok-dhari-singh/index.html" rel="author" title="Alok Singh">Alok Singh</a></p></header></div><div class="main__right"><div class="post__entry"><p>Let me start by sharing my final docker file. The docker file builds a react project and serves it using nginx.</p><p>It itself is pretty descriptive, but if there is anything you don't understand then ping me.</p><div><div> </div><pre>#First we build the app.<br><br>FROM node:alpine3.10 as build<br><br>WORKDIR /app<br><br>RUN echo "Starting stage 1 Build"<br><br>#We pass arguments to run our build<br>ARG yourregistrytoken<br>ARG someapiurl<br>ARG cdnurl<br>ARG buildNumber<br><br>ENV NODE_ENV=production<br><br>COPY .dockernpmrc ./.npmrc<br><br>COPY ["package.json", "package-lock.json*", "./"]<br><br>RUN npm set progress=false &amp;&amp; \<br>    npm config set depth 0 &amp;&amp; \<br>    npm install --only=production    <br><br>RUN rm -f .npmrc<br><br>COPY . ./<br><br>RUN rm -f .env<br>RUN rm -f .env.local<br>RUN rm -rf build<br><br># I have a custom docker env file that I copy and replace values in.<br>COPY .dockerenv ./.env<br><br># This code below replaces the values from the argument.<br>RUN sed -i "s/#someapiurl#/${someapiurl}/g" ./.env<br>RUN sed -i "s/#cdnurl#/${cdnurl}/g" ./.env<br>RUN sed -i "s/#buildNumber#/${buildNumber}/g" ./package.json<br>RUN cat ./.env<br><br># Just to check what is going on with the files.<br>RUN ls -al<br><br># Let's run the NPM build<br>RUN npm run build<br><br># #Stage two - Take the Build folder and serve :)<br><br>FROM nginx:alpine<br>RUN rm /etc/nginx/conf.d/default.conf<br>COPY --from=build /app/build /usr/share/nginx/html<br>COPY ./nginx.conf /etc/nginx/conf.d<br><br>ENTRYPOINT ["nginx", "-g", "daemon off;"]<br><br><br><br><br></pre><hr><p>This results in a super tiny docker image of about 40mb and runs smoothly in kubernetes. The load time is zero for the image is compiled and the entry point is with nginx. Honestly, it took me a while to get to this and I really hope I save someone some time. :) </p></div><footer><div class="post__tag-share"><div class="post__share"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Falokdhari.com%2Freact-app-build-on-docket-in-kubernetes%2Findex.html" class="js-share facebook" aria-label="Share with Facebook" rel="nofollow noopener noreferrer"><svg class="icon"><use xlink:href="https://alokdhari.com/assets/svg/svg-map.svg#facebook"/></svg> </a><a href="http://www.linkedin.com/shareArticle?url=https%3A%2F%2Falokdhari.com%2Freact-app-build-on-docket-in-kubernetes%2Findex.html&amp;title=React%20App%20Build%20on%20Docker%20for%20Kubernetes" class="js-share linkedin" aria-label="[MISSING TRANSLATION] Share with LinkedIn" rel="nofollow noopener noreferrer"><svg class="icon"><use xlink:href="https://alokdhari.com/assets/svg/svg-map.svg#linkedin"/></svg></a></div></div></footer></div></div></article></main><footer class="footer"><div class="footer__social"><a href="https://www.linkedin.com/in/alokdharisingh/" class="linkedin" aria-label="LinkedIn"><svg class="icon"><use xlink:href="https://alokdhari.com/assets/svg/svg-map.svg#linkedin"/></svg></a></div><div class="footer__copyright">Powered by <a href="https://getpublii.com" target="_blank" rel="nofollow noopener">Publii</a>, <a href="https://pages.github.com/">Github Pages</a> and gorgeous images from <a href="https://unsplash.com">Unsplash</a></div></footer></div></div><script defer="defer" src="https://alokdhari.com/assets/js/scripts.min.js?v=babd20e2a0a25821e63a0529c9feaae0"></script><script>var images = document.querySelectorAll('img[loading]');
   
           for (var i = 0; i < images.length; i++) {
               if (images[i].complete) {
                   images[i].classList.add('is-loaded');
               } else {
                   images[i].addEventListener('load', function () {
                       this.classList.add('is-loaded');
                   }, false);
               }
           }</script></body></html>